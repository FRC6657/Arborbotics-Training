# Motion Profiles

## Motion Profiles are a way to smoothly control a mechanism by combining PID and FF control

As the [Controls](3.1_ControlsIntro.md) article covered, it is often beneficial to combine feedforward and feedback (for our use, usually PID) control.
When we want to control the _position_ of a mechanism, however, we're limited by the fact that feedforward for a DC motor (such as a Kraken X60) controls _velocity_.

A motion profile smoothly interpolates, or transitions between, between a starting position and a setpoint position.
There are various types of motion profiles, but the one we use most often is called a _trapezoidal motion profile_.

![An illustration of a trapezoidal motion profile](../../Assets/MotionProfileExample.webp)

This graph shows a motion profile over time, although the specific values aren't important.
The blue line is the position of the controller, the black line is the velocity of the controller and the red line is acceleration.
You can see the 3 phases of the profile, with an accelerating phase at the start (the first leg of the trapezoid), a cruising phase through most of the profile (the top base), and a deaccelerating phase at the end(the second leg).
The position line smoothly starts and stops, resulting in clean movement of the mechanism which minimizes wasted effort.
The real advantage of this is that now we have both a position and velocity setpoint at any given time, which means that the PID controller can adjust for disturbances in position while the feedforward controller can provide the majority of the control effort to get to the setpoint.

### Resources

- [What is a motion profile?](https://www.motioncontroltips.com/what-is-a-motion-profile/)
- [WPILib TrapezoidProfile docs](https://docs.wpilib.org/en/stable/docs/software/advanced-controls/controllers/trapezoidal-profiles.html)
- [WPILib ProfiledPIDController docs](https://docs.wpilib.org/en/stable/docs/software/advanced-controls/controllers/profiled-pidcontroller.html)

### Examples

- Our 2023 elevator uses motion profiling.

### Exercises

- Add a simulated elevator to your kitbot example code using WPILibs ElevatorSim class, and control it using a ProfiledPIDController and ElevatorFeedforward.

### Notes

- Motion profiling is primarily used for position-controlled mechanisms like elevators and arms.
  It can also be used on velocity controlled mechanisms, although it provides less of a benefit.
- The `MotionMagic` control mode for a TalonFX is really just running motion profiling on the motor controller.
